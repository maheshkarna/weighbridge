<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta content="default-src * data: blob:; style-src * 'unsafe-inline' cdvfile://*; script-src * 'unsafe-inline' 'unsafe-eval' 'unsafe-hashes' cdvfile://* blob:; img-src * data: 'unsafe-inline'; connect-src * 'unsafe-inline';
                frame-src *;" http-equiv="Content-Security-Policy">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' data: blob:; script-src 'self' 'unsafe-eval' 'unsafe-inline' blob: ; style-src 'self' 'unsafe-eval' 'unsafe-inline' ;">

  <!--  <title>Hello World!</title>  <link rel="stylesheet" href="./lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="./lib/videojs/video-js.css"> -->
  <link rel="apple-touch-icon" sizes="76x76" href="./css/assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="./css/assets/img/favicon.png">
  <title>
    Weighbridge Application
  </title>
  <!--   Fonts and icons     -->
  <link href="./css/assets/js/family.css" rel="stylesheet" />

  <!-- Nucleo Icons -->
  <link href="./css/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="./css/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->


  <link href="./css/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="./css/assets/css/soft-ui-dashboard.css?v=1.0.7" rel="stylesheet" />


  <style type="text/css">
    @media (min-width: 1200px) {
      .sidenav.fixed-start~.main-content {
        margin-left: 5.125rem;
        margin-right: 5rem;
      }
    }
  </style>
</head>


<body class="g-sidenav-show bg-gray-100">
  
  
  <!-- Mail Pop Start -->
  <div class="modal fade xl" id="mail_pop">
    <div class="modal-dialog shadow-lg p-3 mb-5 bg-white rounded">
      <div class="modal-content sub-bg">
        <div class="modal-header subs-header">
        </div>
        <div class="modal-body">
          <div class="text-center ">
            <h4 class="shadow p-3 mb-3">Enter Your Gmail</h4>
            <input type="text" id="email" name="email" class="form-control" placeholder="Please Enter Email">
          </div>
          <div class="row" style="margin-top: 20px;">
            <div class="col-md-2">  
            </div> 
            <div class="col-md-8">  <button class="btn btn-success text-center" onclick="sendMail()" style="float: right;" >Send</button>
              <button class="btn btn-danger text-center" id="closePop">Not Now</button></div>
            <div class="col-md-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mail Pop End -->


  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 "
    id="sidenav-main" style="display: none">
  </aside>
  <div class="main-content position-relative bg-gray-100 max-height-vh-100 h-100">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg bg-transparent shadow-none position-absolute px-4 w-100 z-index-2">
      <div class="container-fluid py-1">

      </div>
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid">
      <div class="page-header min-height-100 border-radius-xl">
        <span class="mask bg-gradient-primary opacity-6"></span>
      </div>
      <div class="card card-body blur shadow-blur mx-4 mt-n6 overflow-hidden">
        <div class="row gx-4">
          <div class="col-auto">
            <div class="avatar avatar-xl position-relative">
              <img src="" id="logo" alt="profile_image" class="w-100 border-radius-lg shadow-sm">
            </div>
          </div>
          <div class="col-auto my-auto">
            <div class="h-100">
              <h5 class="mb-1" id="title">

              </h5>
              <p class="mb-0 font-weight-bold text-sm" id="subTitle">

              </p>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 my-sm-auto ms-sm-auto me-sm-0 mx-auto mt-3">
            <div class="nav-wrapper position-relative end-0">
              <ul class="nav nav-pills nav-fill p-1 bg-transparent" role="tablist">
                <!-- <li class="nav-item">
                    <a class="nav-link mb-0 px-0 py-1 active " data-bs-toggle="tab" href="javascript:;" role="tab" aria-selected="true">
                     
                  <span class="ms-1"><input type="text" class="form-control"></span>  
                    </a>
                    <li> -->
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid py-4">
      <div class="container-fluid py-4">
        <div class="row">

          <div class="col-12 col-xl-12">
            <div class="card h-100">
              <div class="card-header pb-0 p-3">
                <h6 class="mb-0">ITEM NAME WISE</h6>
              </div>
              <div class="card-body">
                <form>
                  <div class="row">
                    <div class="col-3 col-xl-3">
                      <div class="mb-3">
                        <label>FROM DATE</label>
                        <input type="date" class="form-control" placeholder="Date" aria-label="Name" name="from_date"
                          id="from_date" title="From date" onchange="app.itemWise.getData('V')">
                      </div>
                    </div>

                    <div class="col-3 col-xl-3">
                      <div class="mb-3">
                        <label>TO DATE</label>
                        <input type="date" class="form-control" placeholder="To Date" id="to_date" name="to_date"
                          aria-label="Name" title="To Date" onchange="app.itemWise.getData('V')">
                      </div>
                    </div>

                    <div class="col-3 col-xl-3">
                      <div class="mb-3">
                        <label>WT STATUS</label>
                        <select id="status" name="status" class="form-control" onchange="app.itemWise.getData('V')">
                          <option value="">ALL</option>
                          <option value="0">Pending</option>
                          <option value="1">Completed</option>
                        </select>
                      </div>
                    </div>

                    <div class="col-3 col-xl-3">
                      <div class="mb-3">
                        <label>ITEM NAME</label>
                        <!-- <input type="text" class="form-control" placeholder="Item Name" id="item_name" name="item_name" aria-label="Name" aria-describedby="email-addon" title="Item Name"> -->
                        <select id="item_name" name="item_name" class="form-control" onchange="app.itemWise.getData('V')">
                          <option value="">ALL</option>
                        </select>
                      </div>
                    </div>

                    <!-- <div class="col-4 col-xl-4">
                              <div class="mb-3">
                                <label>Summary Reports With Details</label>
                                <div class="form-check form-switch ps-0">
                                <input class="form-check-input ms-auto" type="checkbox" id="Reports" name="Reports" checked="">
                                <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" for="flexSwitchCheckDefault"></label>
                                </div>
                              </div>
                             </div> -->
                  </div>

                  <!-- <a class="btn btn-dark btn-sm mb-0 me-3" style="float:right;"
                    onclick="app.itemWise.getData('V')">View</a> -->
                  <a class="btn btn-dark btn-sm mb-0 me-3" style="float:right;"
                    onclick="app.itemWise.getData('P')">Print</a>
                  <a class="btn btn-dark btn-sm mb-0 me-3" style="float:right;" href="reportsHome.html">Back</a>
                  <a class="btn btn-dark btn-sm mb-0 me-3" style="float:left;" onclick="itemPdf()">Export PDF</a>
                  <!-- <a class="btn btn-dark btn-sm mb-0 me-3" style="float:left;" onclick="createAsPDF()">Export PDF</a> -->

                  <a class="btn btn-dark btn-sm mb-0 me-3" style="float:left;" onclick="exportExcel_ItemData()">Export
                    EXCEL</a>

                  <a class="btn btn-dark btn-sm mb-0 me-3" style="float:left;" onclick="mail_Pop()">Send To Mail</a>
                </form>
              </div>
              <div class="card-body" id="ItemTable">
                <div class="table-responsive" style="height: 500px; overflow-y: auto;">

                  <table class="table table-striped" id="table-data">
                    <thead>
                      <tr style="text-align:center;">
                        <th scope="col">S.No</th>
                        <th scope="col">Slip.No</th>
                        <th scope="col">In <br>Time & Date</th>
                        <th scope="col">Out <br>Time & Date</th>
                        <th scope="col">Item</th>
                        <th scope="col">Party</th>
                        <th scope="col">Tare</th>
                        <th scope="col">Gross</th>
                        <th scope="col">Net</th>
                        <th scope="col">VehicleNo</th>
                        <th scope="col">WT Status</th>

                      </tr>
                    </thead>
                    <tbody id="itemsReport">
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer pt-3  ">
    <div class="container-fluid">
      <div class="row align-items-center justify-content-lg-between">
        <div class="col-lg-12 mb-lg-0 mb-4">
          <div class="copyright text-center text-sm text-muted text-lg-start">
            Â©
            <script>
              document.write(new Date().getFullYear())
            </script>,
            made with
            <a href="#" class="font-weight-bold" target="_blank">Spondias Private Limited</a>

          </div>
        </div>
      </div>
    </div>
  </footer>
  </div>
  </div>
  <div class="fixed-plugin">

    <div class="card shadow-lg ">
      <div class="card-header pb-0 pt-3 ">
        <div class="float-start">
          <h5 class="mt-3 mb-0">Soft UI Configurator</h5>
          <p>See our dashboard options.</p>
        </div>
        <div class="float-end mt-4">
          <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
            <i class="fa fa-close"></i>
          </button>
        </div>
        <!-- End Toggle Button -->
      </div>
      <hr class="horizontal dark my-1">
      <div class="card-body pt-sm-3 pt-0">
        <!-- Sidebar Backgrounds -->
        <div>
          <h6 class="mb-0">Sidebar Colors</h6>
        </div>
        <a href="javascript:void(0)" class="switch-trigger background-color">
          <div class="badge-colors my-2 text-start">
            <span class="badge filter bg-gradient-primary active" data-color="primary"
              onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-dark" data-color="dark" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-success" data-color="success" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-warning" data-color="warning" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-danger" data-color="danger" onclick="sidebarColor(this)"></span>
          </div>
        </a>
        <!-- Sidenav Type -->
        <div class="mt-3">
          <h6 class="mb-0">Sidenav Type</h6>
          <p class="text-sm">Choose between 2 different sidenav types.</p>
        </div>
        <div class="d-flex">
          <button class="btn bg-gradient-primary w-100 px-3 mb-2 active" data-class="bg-transparent"
            onclick="sidebarType(this)">Transparent</button>
          <button class="btn bg-gradient-primary w-100 px-3 mb-2 ms-2" data-class="bg-white"
            onclick="sidebarType(this)">White</button>
        </div>
        <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
        <!-- Navbar Fixed -->
        <div class="mt-3">
          <h6 class="mb-0">Navbar Fixed</h6>
        </div>
        <div class="form-check form-switch ps-0">
          <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed" onclick="navbarFixed(this)">
        </div>
        <hr class="horizontal dark my-sm-4">
        <a class="btn bg-gradient-dark w-100" href="https://www.creative-tim.com/product/soft-ui-dashboard">Free
          Download</a>
        <a class="btn btn-outline-dark w-100"
          href="https://www.creative-tim.com/learning-lab/bootstrap/license/soft-ui-dashboard">View documentation</a>
        <div class="w-100 text-center">
          <a class="github-button" href="https://github.com/creativetimofficial/soft-ui-dashboard"
            data-icon="octicon-star" data-size="large" data-show-count="true"
            aria-label="Star creativetimofficial/soft-ui-dashboard on GitHub">Star</a>
          <h6 class="mt-3">Thank you for sharing!</h6>
          <a href="https://twitter.com/intent/tweet?text=Check%20Soft%20UI%20Dashboard%20made%20by%20%40CreativeTim%20%23webdesign%20%23dashboard%20%23bootstrap5&amp;url=https%3A%2F%2Fwww.creative-tim.com%2Fproduct%2Fsoft-ui-dashboard"
            class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-twitter me-1" aria-hidden="true"></i> Tweet
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.creative-tim.com/product/soft-ui-dashboard"
            class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-facebook-square me-1" aria-hidden="true"></i> Share
          </a>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="./lib/jquery/jquery-3.6.3.min.js"></script>
<script src="./css/assets/js/jspdf.js"></script>
<script src="./css/assets/js/jspdf.plugin.autotable.min.js"></script>


<script src="./css/assets/js/xlsx.full.min.js"></script>
<link href="./css/assets/css/toastr.css" rel="stylesheet" />
<script src="./css/assets/js/toastr.js"></script>

<!--   <script src="./lib/bootstrap/js/bootstrap.min.js"></script> -->
<script src="./css/assets/js/core/popper.min.js"></script>
<script src="./css/assets/js/core/bootstrap.min.js"></script>
<script src="./css/assets/js/plugins/perfect-scrollbar.min.js"></script>
<script src="./css/assets/js/plugins/smooth-scrollbar.min.js"></script>
<script src="./css/assets/js/soft-ui-dashboard.min.js?v=1.0.7"></script>
<script src="./lib/videojs/video.min.js"></script>
<script src="./css/assets/js/42d5adcbca.js" crossorigin="anonymous"></script>
<script src="./js/database.js"></script>

<script src="./js/general.js"></script>
<script src="./js/db/dateCheckRepo.js"></script>

<script src="./js/db/customerTables.js"></script>
<script src="./js/db/reportsRepository.js"></script>
<script src="./js/reports.js"></script>

<script src="./js/db/navbarSettingsRepo.js"></script>
<script src="./js/navbarSettings.js"></script>

<script>
  document.getElementById('to_date').valueAsDate = new Date();
  document.getElementById('from_date').valueAsDate = new Date();

  function itemPdf() {
    let title = document.getElementById('title').innerHTML
    let fd = $('#from_date').val();
   let td = $('#to_date').val();
    const doc = new jsPDF({
  orientation: 'landscape',
  unit: 'mm',
  format: 'a4',
});

// Heading data
let headingText = title;
let subtitleText = `Detailed Weigments Report From ${fd} 00:00:00 To ${td} 23:59:59`;
let headingFontSize = 14;
let subtitleFontSize = 10;
let headingMargin = 0;
let subtitleMargin = -6;

// Calculate heading width and x-position
let headingWidth = doc.getStringUnitWidth(headingText) * headingFontSize / doc.internal.scaleFactor;
let headingXPos = (doc.internal.pageSize.width - headingWidth) / 2;

// Calculate subtitle width and x-position
let subtitleWidth = doc.getStringUnitWidth(subtitleText) * subtitleFontSize / doc.internal.scaleFactor;
let subtitleXPos = (doc.internal.pageSize.width - subtitleWidth) / 2;

// Table data
let table = document.getElementById('table-data');
let tableWidth = 270;
let tableHeight = 10;
let normalMargin = 10; // Regular margin for the table
// let headingMargin = 20; // Margin between heading and table

// Calculate the position for the table and set the initial yPos
let tableYPos = normalMargin + headingMargin + headingFontSize + subtitleMargin + subtitleFontSize;
let yPos = tableYPos;

let fontSize = 9;
let columnWidths = [30, 30, 30, 30, 40, 20, 20, 20, 30, 30];

// Add heading to the PDF
doc.setFontSize(headingFontSize);
doc.text(headingXPos, normalMargin, headingText);

// Add subtitle to the PDF
doc.setFontSize(subtitleFontSize);
doc.text(subtitleXPos, normalMargin + headingFontSize + subtitleMargin, subtitleText);

// Loop through table rows
for (let i = 0; i < table.rows.length; i++) {
  let row = table.rows[i];
  let xPos = normalMargin;

  // Loop through cells in the row
  for (let j = 1; j < row.cells.length; j++) {
    let cell = row.cells[j];
    doc.setFontSize(fontSize);
    doc.text(xPos, yPos, cell.innerText);
    xPos += columnWidths[j - 1];
  }
  yPos += tableHeight;
}
  // Save the PDF
 doc.save('ItemReport.pdf');
}
///////////////////saving PDF /////////////////


  $(document).ready(function () {
    app.itemWise.getItemList();
    app.itemWise.getData('V');
    navbarValues();
  })

  function navbarValues() {
    $.when(
      app.database.tables.navbar.checknavbarData()
    ).done(function (data) {
      console.log(data);
      if (data == null || data.length == 0) {
        app.database.tables.navbar.insertData();
      } else {
        document.getElementById("title").innerHTML = data[0].TITLE;
        document.getElementById("subTitle").innerHTML = data[0].SUBTITLE;
        document.getElementById("logo").src = data[0].LOGO;
      }
    });
  }

//////////////// Convert Pdf ///////////////

/////////////////////  Send Report To Email /////////////
function mail_Pop(){
  $('#mail_pop').modal('show');
}

$('#closePop').click(function (){
  $('#mail_pop').modal('hide');
})

function sendMail(){
      let email = $('#email').val();
      if(email != ""){
        let fd = $('#from_date').val();
        let td = $('#to_date').val();
        let  title = `Detailed Excel Weighment Report from ${fd} to ${td}`;
           const tableData = Array.from(document.querySelectorAll('#ItemTable tr')).map(row =>
               Array.from(row.querySelectorAll('td, th')).map(cell => cell.innerText)
           );
           const encodedData = encodeURIComponent(JSON.stringify(tableData));
           const encodedTitle = encodeURIComponent(title); // Encode the title
           const dataURL = `http://localhost:8686/mailSendExel?data=${encodedData}&title=${encodedTitle}&email=${email}`;
           $.ajax({
               url: dataURL,
               type: 'GET',
               cache: false,
               success: function (data) {
                   if (data === true) {
                    $('#mail_pop').modal('hide');
                    toastr.success('Mail Sent Successfully', '', {timeOut: 1000});   
                   }
               },
               error: function () {
                   alert('Error occurred while sending the request');
               }
           });
      }else{
        toastr.error('Please Enter Your Email', '', {timeOut: 1000});
      }
  }


//////////////////////////// Export In Excell  ////////////////////////////////////
function exportExcel_ItemData() {
  let data = document.getElementById('ItemTable');
  const uniqueId = Date.now().toString(36);
  var fp = XLSX.utils.table_to_book(data, { sheet: 'Sheet-1' });
  XLSX.write(fp, {
    bookType: 'xlsx',
    type: 'base64'
  });
  XLSX.writeFile(fp, 'ItemWise-' + uniqueId + '.xlsx');
}

</script>

</html>